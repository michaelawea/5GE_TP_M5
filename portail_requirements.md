# 双扇门式大门控制系统 - 需求分析文档

## 1. 项目概述

本文档定义了双扇门式自动大门控制系统的完整需求规格。该系统用于控制私人住宅的出入，支持单扇门（行人/两轮车）和双扇门（车辆）两种开启模式。

## 2. 需求分类

### 2.1 功能需求（FR - Functional Requirements）

#### FR1: 门扇控制需求
- **FR1.1** [高优先级]: 系统应能独立控制门扇1的开启和关闭
- **FR1.2** [高优先级]: 系统应能独立控制门扇2的开启和关闭
- **FR1.3** [高优先级]: 系统应能同时控制两扇门的开启和关闭
- **FR1.4** [中优先级]: 系统应支持部分开启模式（仅门扇1）用于行人通行
- **FR1.5** [中优先级]: 系统应支持完全开启模式（两扇门）用于车辆通行

#### FR2: 用户接口需求
- **FR2.1** [高优先级]: 系统应支持无线遥控器控制
  - FR2.1.1: 遥控器按钮1控制单扇门
  - FR2.1.2: 遥控器按钮2控制双扇门
- **FR2.2** [高优先级]: 系统应支持密码键盘控制
  - FR2.2.1: 输入代码1504开启单扇门
  - FR2.2.2: 输入代码2502开启双扇门
- **FR2.3** [中优先级]: 系统应支持对讲机控制
  - FR2.3.1: 访客可通过门铃按钮呼叫住户
  - FR2.3.2: 住户可通过内部装置控制单扇或双扇门

#### FR3: 状态监测需求
- **FR3.1** [高优先级]: 系统应能检测门扇1的完全关闭状态
- **FR3.2** [高优先级]: 系统应能检测门扇2的完全关闭状态
- **FR3.3** [高优先级]: 系统应能检测门扇1的完全开启状态
- **FR3.4** [高优先级]: 系统应能检测门扇2的完全开启状态
- **FR3.5** [中优先级]: 系统应能检测电机电流状态

#### FR4: 信号指示需求
- **FR4.1** [中优先级]: 系统应在门扇移动时激活橙色信号灯
- **FR4.2** [低优先级]: 系统应在门扇操作时提供区域照明

### 2.2 安全需求（SR - Safety Requirements）

- **SR1** [极高优先级]: 系统应配备通道传感器检测移动区域内的障碍物
- **SR2** [极高优先级]: 检测到障碍物时，系统应立即停止门扇移动
- **SR3** [极高优先级]: 系统应监测电机过流情况（防夹功能）
- **SR4** [极高优先级]: 检测到过流时，系统应立即停止并反向移动门扇
- **SR5** [高优先级]: 系统应在门扇移动前激活警告信号
- **SR6** [高优先级]: 系统应检测市电缺失并触发相应报警
- **SR7** [中优先级]: 在安全事件后，系统应要求手动复位才能恢复正常操作

### 2.3 技术约束需求（TR - Technical Requirements）

- **TR1** [高优先级]: 系统应基于Schneider Electric M340 PLC实现
- **TR2** [高优先级]: 系统应使用Unity Pro软件进行编程
- **TR3** [中优先级]: 系统应采用模块化设计（DFB派生功能块）
- **TR4** [中优先级]: 系统应支持以太网通信（IP: 134.214.184.171）
- **TR5** [低优先级]: 系统应提供16路数字输入和16路数字输出接口

## 3. 使用案例（Use Cases）

### UC1: 正常操作场景

#### UC1.1: 遥控器开门
**前置条件**: 门扇处于关闭状态
**触发**: 用户按下遥控器按钮
**主流程**:
1. 用户按下遥控器按钮（按钮1或按钮2）
2. 系统接收命令信号
3. 系统激活橙色信号灯
4. 系统激活区域照明
5. 系统启动相应电机（单扇或双扇）
6. 门扇开始开启
7. 系统监测开启过程
8. 门扇到达完全开启位置
9. 系统停止电机
**后置条件**: 门扇处于开启状态

#### UC1.2: 密码键盘开门
**前置条件**: 门扇处于关闭状态
**触发**: 用户输入正确密码
**主流程**:
1. 用户在键盘输入密码（1504或2502）
2. 系统验证密码
3. 如密码正确，执行UC1.1的步骤3-9
**异常流程**:
- 密码错误：系统拒绝操作，可能触发报警

#### UC1.3: 对讲机开门
**前置条件**: 门扇处于关闭状态
**触发**: 访客按下门铃
**主流程**:
1. 访客按下外部对讲机门铃按钮
2. 内部对讲机发出铃声
3. 住户按下内部控制按钮（单扇或双扇）
4. 执行UC1.1的步骤3-9

### UC2: 安全响应场景

#### UC2.1: 障碍物检测响应
**前置条件**: 门扇正在移动
**触发**: 通道传感器检测到障碍物
**主流程**:
1. 传感器检测到移动区域内有障碍物
2. 系统立即停止所有门扇移动
3. 系统保持信号灯闪烁
4. 系统等待障碍物清除
5. 障碍物清除后，系统可能需要手动复位
**后置条件**: 门扇停止，等待进一步操作

#### UC2.2: 过流保护响应
**前置条件**: 门扇正在关闭
**触发**: 电流传感器检测到过流（可能夹到物体）
**主流程**:
1. 电流传感器检测到异常电流
2. 系统立即停止门扇移动
3. 系统反向移动门扇至完全开启
4. 系统触发报警信号
5. 系统要求手动复位
**后置条件**: 门扇开启，系统处于报警状态

### UC3: 冲突处理场景

#### UC3.1: 开门过程中收到关门命令
**前置条件**: 门扇正在开启
**触发**: 用户发送关门命令
**主流程**:
1. 系统正在执行开门操作
2. 系统接收到关门命令
3. 系统完成当前开门动作
4. 系统等待门扇完全开启
5. 系统执行关门命令
**设计决策**: 优先完成当前动作，避免频繁换向

#### UC3.2: 多个控制源同时操作
**前置条件**: 系统空闲
**触发**: 遥控器和对讲机同时发送命令
**主流程**:
1. 系统接收多个控制命令
2. 系统按优先级处理（建议：对讲机 > 遥控器 > 密码键盘）
3. 系统执行最高优先级命令
4. 系统忽略或排队其他命令
**设计决策**: 需定义清晰的优先级策略

#### UC3.3: 市电缺失情况
**前置条件**: 系统正常运行
**触发**: 检测到市电缺失
**主流程**:
1. 系统检测到市电缺失报警
2. 如门扇正在移动，立即停止
3. 系统切换到应急模式（如有备用电源）
4. 系统可能允许手动操作
5. 记录事件日志
**后置条件**: 系统处于应急/手动模式

## 4. 需求优先级矩阵

| 优先级 | 需求类别 | 需求编号 | 理由 |
|--------|----------|----------|------|
| 极高 | 安全需求 | SR1-SR4 | 人身安全，法规要求 |
| 高 | 功能需求 | FR1.1-FR1.3, FR2.1-FR2.2, FR3.1-FR3.4 | 核心功能 |
| 高 | 安全需求 | SR5-SR6 | 安全预警 |
| 高 | 技术约束 | TR1-TR2 | 项目约束 |
| 中 | 功能需求 | FR1.4-FR1.5, FR2.3, FR3.5, FR4.1 | 增强功能 |
| 中 | 安全需求 | SR7 | 操作安全 |
| 中 | 技术约束 | TR3-TR4 | 设计要求 |
| 低 | 功能需求 | FR4.2 | 舒适性功能 |
| 低 | 技术约束 | TR5 | 硬件规格 |

## 5. 非功能需求

### 5.1 性能需求
- **NFR1**: 系统响应时间应小于500ms
- **NFR2**: 门扇完全开启/关闭时间应在10-15秒范围内
- **NFR3**: 安全响应（停止）时间应小于100ms

### 5.2 可靠性需求
- **NFR4**: 系统应支持24/7连续运行
- **NFR5**: 系统应具备故障自诊断功能
- **NFR6**: 平均故障间隔时间(MTBF)应大于10000小时

### 5.3 可维护性需求
- **NFR7**: 系统应提供清晰的状态指示
- **NFR8**: 系统应支持远程诊断和参数调整
- **NFR9**: 系统应记录操作和故障日志

## 6. 状态转换图

```
初始状态：门扇关闭
├─> 接收开门命令
│   ├─> 安全检查通过
│   │   ├─> 开始开门
│   │   ├─> 监测过程
│   │   │   ├─> 检测到障碍 -> 紧急停止
│   │   │   └─> 正常 -> 继续
│   │   └─> 完全开启
│   └─> 安全检查失败 -> 保持关闭
├─> 门扇开启状态
│   ├─> 接收关门命令
│   ├─> 开始关门
│   ├─> 监测过程
│   │   ├─> 检测到过流 -> 反向开启
│   │   └─> 正常 -> 继续
│   └─> 完全关闭
└─> 紧急状态
    ├─> 等待复位
    └─> 手动操作模式
```

## 7. 验收标准

1. 所有极高和高优先级需求必须100%实现
2. 中优先级需求至少实现80%
3. 所有安全功能必须经过完整测试
4. 系统必须通过24小时连续运行测试
5. 响应时间必须满足性能需求
6. 必须提供完整的操作和维护文档

## 8. 风险分析

| 风险 | 概率 | 影响 | 缓解措施 |
|------|------|------|----------|
| 传感器故障 | 中 | 高 | 冗余设计，定期检查 |
| 电机过热 | 低 | 中 | 温度监控，使用周期限制 |
| 通信中断 | 低 | 中 | 本地控制备份 |
| 电源故障 | 中 | 高 | UPS备用电源 |
| 恶意入侵 | 低 | 高 | 加密通信，访问控制 |

## 9. 后续步骤

1. 与客户（TP指导教师）确认需求理解
2. 获得需求批准
3. 开始DFB功能块设计
4. 制定详细测试计划
5. 实施敏捷开发流程

---

**文档版本**: 1.0  
**创建日期**: 2025-01-23  
**作者**: 系统工程团队  
**审核状态**: 待审核
