# 5GE - TPTR M5 – M6
# 机电系统控制

## 描述

需要实现控制的系统是一个双扇门式大门（见图1），用于控制私人住宅的出入。部分开启（仅一扇门/门扇：1号）允许行人或两轮车通过。每扇门都配备了带臂的电动装置，可通过可编程装置进行控制，并可通过多个用户界面进行远程操控。

**图1：需要控制的双扇门式大门**

该装置包含用于了解系统状态的传感器，同时也用于确保运行中装置的安全性。两个传感器提供每扇门关闭的信息，两个传感器提供完全开启的信息。一个存在传感器检测两扇门移动区域内的入侵，以便启动安全措施。两个电流传感器检测两个电机组合的任何过流消耗，表明存在强行操作。

控制可通过以下方式进行：
- 配备两个按钮的无线遥控器，用于控制单扇门或双扇门；
- 通常设置在住宅外侧左侧门柱上的无线密码键盘。两个密码控制单扇或双扇门的移动；
- 对讲机：出现在大门前的访客可通过对讲机外部装置按下"门铃"按钮通知住户其存在。然后在内部装置上发出铃声。在此装置上，住户可选择两个按钮来控制单扇或双扇门的移动。

一个橙色信号灯指示门扇开始移动，一盏射灯照亮该区域，以满足安全方面的规定。

控制将在Schneider Electric M340可编程控制器中实施，该控制器已连接来自不同传感器的信号、来自人机界面的信息以及各种执行器的控制信号。不同输入/输出的列表在表1中给出。Unity软件将用于程序开发。您需要使用Canevas_tp_portail.zef文件，该文件可在moodle页面上获取：电气工程 → 杂项 → TPGE → TP 5GE → AU4和TR TP题目，其中API配置已经使用所有这些输入/输出进行了参数设置，作为基础程序。

## 表1：输入/输出

### 输出
| 名称 | 地址 | 类型 | 描述 |
|------|------|------|------|
| 开启_V1 | | BOOL | 门扇1开启命令 |
| 关闭_V1 | | BOOL | 门扇1关闭命令 |
| 开启_V2 | | BOOL | 门扇2开启命令 |
| 关闭_V2 | | BOOL | 门扇2关闭命令 |
| 信号灯 | %Q0.3.4 | EBOOL | 信号灯命令 |
| 照明 | %Q0.3.5 | EBOOL | 区域照明命令 |

### 输入
| 名称 | 地址 | 类型 | 描述 |
|------|------|------|------|
| Bar_Lumineuse | %I0.2.0 | EBOOL | 通道传感器 |
| Capt_Ouv_V2 | %I0.2.1 | EBOOL | 门扇1完全开启传感器 |
| Capt_Ouv_V1 | %I0.2.2 | EBOOL | 门扇2完全开启传感器 |
| Capt_Ferm_V1 | %I0.2.3 | EBOOL | 门扇1感应关闭传感器 |
| Capt_Ferm_V2 | %I0.2.4 | EBOOL | 门扇2感应关闭传感器 |
| Capt_Surintens_V2 | %I0.2.5 | EBOOL | 门扇1防夹传感器 |
| Capt_Surintens_V1 | %I0.2.6 | EBOOL | 门扇2防夹传感器 |
| Cmd_V1_Interphone | %I0.2.7 | EBOOL | 对讲机门扇1开启命令 |
| Cmd_V12_Interphone | %I0.2.8 | EBOOL | 对讲机门扇2开启命令 |
| Cmd_V1_Tele_Digi | %I0.2.9 | EBOOL | 遥控器和密码键盘门扇1开启命令 |
| Cmd_V12_Tele_Digi | %I0.2.10 | EBOOL | 遥控器和密码键盘门扇2开启命令 |
| Alarm_Abs_Secteur | %I0.2.11 | EBOOL | 市电缺失报警 |

---

## 要求完成的工作

### 需求建立

根据前面的零散描述以及与客户（您的TP指导教师）的补充讨论，按照系统工程课程的要求，以SysML格式的需求图形式建立客户需求。

明确区分功能需求与技术和安全约束需求。

当规格说明书不够明确时，提出使用案例，特别是在以下情况下：
- 与安全相关的触发（在门扇移动区域内的检测、过流传感器等）；
- 当某个动作已在进行时的命令；
- ...

为每个需求给出优先级。

**在进入下一阶段之前，请您的TP指导教师验证您的建议和需求。**

### 设计

您需要应用4GE中学到的"自动化组件"方法来设计您的API程序。这将通过开发一个（或如需要多个）派生功能块（DFB）来实现。

"在纸上"明确说明这个/这些DFB完成的功能、它们的输入/输出以及实例数量，以及如何将它们与输入/输出进行接口。

**在进入下一阶段之前，请您的TP指导教师验证您的DFB建议。**

在报告中，说明您的设计方法：您的优先事项、您的选择等。

### 实现

采用敏捷方法：逐步测试您编写的功能！

不要忘记进行回归测试...

在报告中，说明您的实现方法：您的方法、遇到的问题、如何解决它们等。

### 验证

验证您的需求是否得到充分满足。**请您的指导教师验证最终程序。**

在报告中，特别提出一个需求满足矩阵，将所有需求与实现的功能联系起来。

---

## 附录

### 自动化配置：
- 处理器 BMX P34 20102 V2.10
- 以太网耦合器 NOE 100.2
- 16路数字输入卡 DDI1602
- 16路数字输出卡 DDO1602
- NOE 100.2耦合器配置：
  - IP地址：134.214.184.171
  - 子网掩码：255.255.254.0
  - 网关地址：134.214.184.1

### 密码键盘：
- 开启1扇门的代码：1504
- 开启2扇门的代码：2502